# 技术设计: DoT 归因准确性修复

## 技术方案
### 核心技术
- C# / Dalamud Hook / 状态列表扫描 / DoT 威力表同步

### 实现要点
- **DotEventCapture**
  - 调整去重策略，仅在跨通道重复时丢弃，避免同通道与未知来源误删。
  - 当 `buffId=0` 且来源未知时，调用 `ACTBattle` 新增的 buff 推断方法：
    - 目标状态唯一 DoT 状态 → 直接推断
    - 多状态时按伤害匹配，满足误差阈值才采纳
  - 保留未知来源 tick 走模拟分配路径，不计入任意玩家的已知来源 DoT。
- **ACTBattle**
  - 新增 “不依赖来源的 buff 推断” 方法：
    - 从目标状态列表筛选 DotPot 状态
    - 若唯一则返回 buffId
    - 若多个则基于伤害与 DotPot 进行相对误差匹配，低于阈值且区分度足够时返回
  - 复用现有 DPP 与误差阈值策略，避免误归因。
- **Potency**
  - 使用 PotencyUpdater 的 `--ff14mcp-dots` 同步 DotPot。
  - 对缺失状态（如 1221、4972）追加手动覆盖并记录在更新脚本中。
  - 同步更新 DotPot94 以覆盖低等级场景。

## 安全与性能
- **安全:** 不引入外部服务调用；同步工具仅读取本地数据源
- **性能:** 推断仅在 `buffId=0` 时触发；保持去重窗口与缓存规模

## 测试与部署
- **测试:** 游戏内验证
  - 开启 DoT 诊断日志/计数
  - 对比多目标同职业场景：DoT 统计一致性与未知/推断计数变化
- **部署:** 编译插件并替换到 Dalamud 插件目录
